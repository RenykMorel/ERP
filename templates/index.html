{% extends "base.html" %}

{% block title %}Dashboard - CalculAI{% endblock %}

{% block extra_css %}
<style>
    #dashboard {
        display: grid;
        grid-template-columns: 200px 1fr;
        gap: 20px;
        padding: 20px;
        background-color: #f0f2f5;
        height: calc(100vh - 40px); /* Altura total menos el padding */
    }

    

    .main-content {
        grid-column: 2;
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
    }

    .summary-cards {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
    }

    .charts-container {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
    }

    .widgets-container {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
    }

    .summary-card, .chart-wrapper, .widget {
        background-color: white;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .summary-card h4 {
        margin: 0 0 10px 0;
        font-size: 14px;
        color: #333;
    }

    .summary-card p {
        margin: 0;
        font-size: 24px;
        font-weight: bold;
        color: #007EA7;
    }

    .chart-container {
        height: 300px;
    }

    .widget-title {
        font-size: 18px;
        margin-bottom: 15px;
    }

    .task-list, .notification-list {
        list-style-type: none;
        padding: 0;
        margin: 0;
        max-height: 300px;
        overflow-y: auto;
    }

    .task-item, .notification-item {
        padding: 10px 0;
        border-bottom: 1px solid #e0e0e0;
    }

    .task-item:last-child, .notification-item:last-child {
        border-bottom: none;
    }

    
</style>
{% endblock %}

{% block content %}


    <div class="main-content">
        <div class="summary-cards">
            <div class="summary-card">
                <h4>Ingresos Totales</h4>
                <p>$24,000</p>
            </div>
            <div class="summary-card">
                <h4>Gastos Totales</h4>
                <p>$12,000</p>
            </div>
            <div class="summary-card">
                <h4>Beneficio Neto</h4>
                <p>$12,000</p>
            </div>
            <div class="summary-card">
                <h4>Nuevos Clientes</h4>
                <p>120</p>
            </div>
        </div>

        <div class="charts-container">
            <div class="chart-wrapper">
                <h3>Ventas Mensuales</h3>
                <div class="chart-container">
                    <canvas id="line-chart"></canvas>
                </div>
            </div>
            <div class="chart-wrapper">
                <h3>Ingresos vs Gastos</h3>
                <div class="chart-container">
                    <canvas id="bar-chart"></canvas>
                </div>
            </div>
            <div class="chart-wrapper">
                <h3>Distribuci√≥n Financiera</h3>
                <div class="chart-container">
                    <canvas id="pie-chart"></canvas>
                </div>
            </div>
        </div>

        <div class="widgets-container">
            <div id="virtual-assistant">
                <h3>Asistente Virtual</h3>
                <!-- Contenido del asistente virtual -->
            </div>
            <div class="widget">
                <h3 class="widget-title">Tareas Pendientes</h3>
                <ul id="task-list" class="task-list"></ul>
            </div>
            <div class="widget">
                <h3 class="widget-title">Notificaciones</h3>
                <ul id="notification-list" class="notification-list"></ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    initializeCharts();
    loadTasks();
    loadNotifications();
});

function initializeCharts() {
    fetch('/api/datos_graficos')
        .then(response => response.json())
        .then(data => {
            createLineChart(data.ventas);
            createBarChart(data.ingresos_vs_gastos);
            createPieChart(data.distribucion);
        })
        .catch(error => console.error('Error loading chart data:', error));
}

function createLineChart(data) {
    const ctx = document.getElementById('line-chart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: data.labels,
            datasets: [{
                label: 'Ventas',
                data: data.values,
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });
}

function createBarChart(data) {
    const ctx = document.getElementById('bar-chart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: data.labels,
            datasets: [
                {
                    label: 'Ingresos',
                    data: data.ingresos,
                    backgroundColor: 'rgba(75, 192, 192, 0.6)'
                },
                {
                    label: 'Gastos',
                    data: data.gastos,
                    backgroundColor: 'rgba(255, 99, 132, 0.6)'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });
}

function createPieChart(data) {
    const ctx = document.getElementById('pie-chart').getContext('2d');
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: data.labels,
            datasets: [{
                data: data.values,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.8)',
                    'rgba(54, 162, 235, 0.8)',
                    'rgba(255, 206, 86, 0.8)'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });
}

function loadTasks() {
    fetch('/api/tareas')
        .then(response => response.json())
        .then(tasks => {
            const taskList = document.getElementById('task-list');
            taskList.innerHTML = tasks.map(task => `
                <li class="task-item">
                    <div>${task.descripcion}</div>
                    <small>Vence: ${task.vence}</small>
                </li>
            `).join('');
        })
        .catch(error => console.error('Error loading tasks:', error));
}

function loadNotifications() {
    fetch('/api/notificaciones')
        .then(response => response.json())
        .then(notifications => {
            const notificationList = document.getElementById('notification-list');
            notificationList.innerHTML = notifications.map(notification => `
                <li class="notification-item">
                    <div>${notification.mensaje}</div>
                    <small>${notification.tipo}</small>
                </li>
            `).join('');
        })
        .catch(error => console.error('Error loading notifications:', error));
}
</script>
{% endblock %}